{"version":3,"sources":["../../../src/tools/historical/historical.service.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\r\n\r\nexport interface HistoricalTicket {\r\n  ticketId: string;\r\n  category: string;\r\n  priority: string;\r\n  description: string;\r\n  resolution: string;\r\n  resolvedAt: string;\r\n  resolutionTimeHours: number;\r\n}\r\n\r\n@Injectable()\r\nexport class HistoricalService {\r\n  private readonly logger = new Logger(HistoricalService.name);\r\n  private readonly ticketStore: HistoricalTicket[] = [];\r\n\r\n  constructor() {\r\n    this.seedSampleTickets();\r\n  }\r\n\r\n  async query(question: string): Promise<HistoricalTicket[]> {\r\n    const keywords = question.toLowerCase().split(/\\s+/);\r\n    const scored = this.ticketStore.map((ticket) => {\r\n      const text =\r\n        `${ticket.category} ${ticket.priority} ${ticket.description} ${ticket.resolution}`.toLowerCase();\r\n      const score = keywords.reduce(\r\n        (acc, kw) => acc + (text.includes(kw) ? 1 : 0),\r\n        0,\r\n      );\r\n      return { ticket, score };\r\n    });\r\n\r\n    return scored\r\n      .filter((s) => s.score > 0)\r\n      .sort((a, b) => b.score - a.score)\r\n      .slice(0, 5)\r\n      .map((s) => s.ticket);\r\n  }\r\n\r\n  addTicket(ticket: HistoricalTicket): void {\r\n    this.ticketStore.push(ticket);\r\n  }\r\n\r\n  private seedSampleTickets(): void {\r\n    const samples: HistoricalTicket[] = [\r\n      {\r\n        ticketId: 'HIST-001',\r\n        category: 'Infrastructure',\r\n        priority: 'P1-Critical',\r\n        description:\r\n          'Production database server unresponsive, all services affected',\r\n        resolution:\r\n          'Identified memory leak in connection pooling. Restarted service and applied connection limit patch.',\r\n        resolvedAt: '2025-12-15T14:30:00Z',\r\n        resolutionTimeHours: 2.5,\r\n      },\r\n      {\r\n        ticketId: 'HIST-002',\r\n        category: 'Security',\r\n        priority: 'P1-Critical',\r\n        description:\r\n          'Suspected unauthorized access to admin accounts detected by monitoring',\r\n        resolution:\r\n          'Disabled compromised accounts, rotated credentials, applied MFA enforcement. Root cause: phishing attack.',\r\n        resolvedAt: '2025-11-20T09:00:00Z',\r\n        resolutionTimeHours: 4,\r\n      },\r\n      {\r\n        ticketId: 'HIST-003',\r\n        category: 'Network',\r\n        priority: 'P2-High',\r\n        description: 'VPN connectivity failures affecting remote workforce',\r\n        resolution:\r\n          'VPN gateway certificate expired. Renewed certificate and restarted VPN concentrator.',\r\n        resolvedAt: '2025-10-05T16:45:00Z',\r\n        resolutionTimeHours: 1.5,\r\n      },\r\n      {\r\n        ticketId: 'HIST-004',\r\n        category: 'Software',\r\n        priority: 'P2-High',\r\n        description:\r\n          'Email system delivery delays exceeding 30 minutes for all users',\r\n        resolution:\r\n          'Mail queue backlog due to anti-spam filter misconfiguration. Corrected filter rules and flushed queue.',\r\n        resolvedAt: '2025-09-18T11:20:00Z',\r\n        resolutionTimeHours: 3,\r\n      },\r\n      {\r\n        ticketId: 'HIST-005',\r\n        category: 'Cloud',\r\n        priority: 'P2-High',\r\n        description:\r\n          'AWS S3 bucket permissions misconfigured exposing internal documents',\r\n        resolution:\r\n          'Reverted bucket policy to private, enabled CloudTrail logging, audited access logs.',\r\n        resolvedAt: '2025-08-22T08:15:00Z',\r\n        resolutionTimeHours: 1,\r\n      },\r\n      {\r\n        ticketId: 'HIST-006',\r\n        category: 'Database',\r\n        priority: 'P2-High',\r\n        description:\r\n          'Database replication lag exceeding 60 seconds on read replicas',\r\n        resolution:\r\n          'Optimized slow queries causing write amplification. Added missing indexes on frequently joined tables.',\r\n        resolvedAt: '2025-07-30T13:00:00Z',\r\n        resolutionTimeHours: 5,\r\n      },\r\n      {\r\n        ticketId: 'HIST-007',\r\n        category: 'Access Management',\r\n        priority: 'P3-Medium',\r\n        description: 'New employee unable to access required applications',\r\n        resolution:\r\n          'Provisioned AD groups and application-specific roles per department onboarding checklist.',\r\n        resolvedAt: '2025-07-15T10:30:00Z',\r\n        resolutionTimeHours: 0.5,\r\n      },\r\n      {\r\n        ticketId: 'HIST-008',\r\n        category: 'Hardware',\r\n        priority: 'P3-Medium',\r\n        description:\r\n          'Multiple workstations reporting intermittent blue screen errors',\r\n        resolution:\r\n          'Faulty RAM modules identified in batch. Replaced DIMM sticks and updated BIOS firmware.',\r\n        resolvedAt: '2025-06-10T15:45:00Z',\r\n        resolutionTimeHours: 8,\r\n      },\r\n      {\r\n        ticketId: 'HIST-009',\r\n        category: 'Monitoring',\r\n        priority: 'P3-Medium',\r\n        description: 'Alerting system sending false positive notifications',\r\n        resolution:\r\n          'Threshold values were too aggressive after infrastructure scaling. Adjusted alert thresholds and added cooldown periods.',\r\n        resolvedAt: '2025-05-28T09:30:00Z',\r\n        resolutionTimeHours: 2,\r\n      },\r\n      {\r\n        ticketId: 'HIST-010',\r\n        category: 'Service Request',\r\n        priority: 'P4-Low',\r\n        description: 'Request for additional monitor for developer workstation',\r\n        resolution:\r\n          'Approved and fulfilled from inventory. Updated asset tracking system.',\r\n        resolvedAt: '2025-05-01T14:00:00Z',\r\n        resolutionTimeHours: 24,\r\n      },\r\n    ];\r\n\r\n    samples.forEach((t) => this.ticketStore.push(t));\r\n  }\r\n}\r\n"],"names":["HistoricalService","query","question","keywords","toLowerCase","split","scored","ticketStore","map","ticket","text","category","priority","description","resolution","score","reduce","acc","kw","includes","filter","s","sort","a","b","slice","addTicket","push","seedSampleTickets","samples","ticketId","resolvedAt","resolutionTimeHours","forEach","t","logger","Logger","name"],"mappings":";;;;+BAaaA;;;eAAAA;;;wBAbsB;;;;;;;;;;AAa5B,IAAA,AAAMA,oBAAN,MAAMA;IAQX,MAAMC,MAAMC,QAAgB,EAA+B;QACzD,MAAMC,WAAWD,SAASE,WAAW,GAAGC,KAAK,CAAC;QAC9C,MAAMC,SAAS,IAAI,CAACC,WAAW,CAACC,GAAG,CAAC,CAACC;YACnC,MAAMC,OACJ,GAAGD,OAAOE,QAAQ,CAAC,CAAC,EAAEF,OAAOG,QAAQ,CAAC,CAAC,EAAEH,OAAOI,WAAW,CAAC,CAAC,EAAEJ,OAAOK,UAAU,EAAE,CAACV,WAAW;YAChG,MAAMW,QAAQZ,SAASa,MAAM,CAC3B,CAACC,KAAKC,KAAOD,MAAOP,CAAAA,KAAKS,QAAQ,CAACD,MAAM,IAAI,CAAA,GAC5C;YAEF,OAAO;gBAAET;gBAAQM;YAAM;QACzB;QAEA,OAAOT,OACJc,MAAM,CAAC,CAACC,IAAMA,EAAEN,KAAK,GAAG,GACxBO,IAAI,CAAC,CAACC,GAAGC,IAAMA,EAAET,KAAK,GAAGQ,EAAER,KAAK,EAChCU,KAAK,CAAC,GAAG,GACTjB,GAAG,CAAC,CAACa,IAAMA,EAAEZ,MAAM;IACxB;IAEAiB,UAAUjB,MAAwB,EAAQ;QACxC,IAAI,CAACF,WAAW,CAACoB,IAAI,CAAClB;IACxB;IAEQmB,oBAA0B;QAChC,MAAMC,UAA8B;YAClC;gBACEC,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aACE;gBACFC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aACE;gBACFC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aAAa;gBACbC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aACE;gBACFC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aACE;gBACFC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aACE;gBACFC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aAAa;gBACbC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aACE;gBACFC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aAAa;gBACbC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;YACA;gBACEF,UAAU;gBACVnB,UAAU;gBACVC,UAAU;gBACVC,aAAa;gBACbC,YACE;gBACFiB,YAAY;gBACZC,qBAAqB;YACvB;SACD;QAEDH,QAAQI,OAAO,CAAC,CAACC,IAAM,IAAI,CAAC3B,WAAW,CAACoB,IAAI,CAACO;IAC/C;IA1IA,aAAc;aAHGC,SAAS,IAAIC,cAAM,CAACpC,kBAAkBqC,IAAI;aAC1C9B,cAAkC,EAAE;QAGnD,IAAI,CAACqB,iBAAiB;IACxB;AAyIF"}